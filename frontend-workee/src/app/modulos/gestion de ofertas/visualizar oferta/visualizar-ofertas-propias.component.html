<div class="tarjeta-ofertas">
  <div class="oferta-header">
    <h1>Ofertas de empleo</h1>
    <p>Gestiona y visualiza todas las ofertas de empleo de tu empresa</p>
  </div>

  <div class="seccion-filtros">
    <div class="filtros">

      <div class="buscador">
        <div class="input-search-wrapper">
          <input
            type="text"
            placeholder="Buscar..."
            class="input-search"
            [(ngModel)]="textoOferta"
            (keyup.enter)="buscarPorNombre(textoOferta)" />
          <button id="icon-button" (click)="buscarPorNombre(textoOferta)">
            <span class="material-symbols-outlined search-icon">search</span>
          </button>
        </div>
      </div>
      <p-multiselect
        [options]="filtrosEstadoOferta"
        placeholder="Estado"
        optionLabel="name"
        optionValue="code"
        [maxSelectedLabels]="0"
        [selectedItemsLabel]="'Estado ({0})'"
        class="filtro"
        [panelStyle]="{ 'background': '#fff' }"
        [(ngModel)]="filtrosSeleccionadosEstadoOferta"
        (onChange)="onEstadosChange()">
      </p-multiselect>
    </div>

    <button type="button" class="btn btn-primary guardar" [routerLink]="['/crear-oferta']">
      <span class="material-symbols-outlined">add</span>
      Crear oferta
    </button>
  </div>
    <div class="botones">
      <button type="button"
          class="btn btn-primary guardar">
        <span type="button" class="material-symbols-outlined">add</span>
        Crear oferta
      </button>
    </div>

  <div class="listado-wrapper">
    <div class="ofertas-grid">
      <div *ngIf="isLoading; else results">
        <app-spinner type="inline" message="Cargando resultados..."></app-spinner>
      </div>

      <ng-template #results>
        @if (ofertas.length === 0) {
          <div class="sin-resultados">
            <img src="assets/img/sin-resultados.png" alt="Sin resultados" class="sin-resultados-img">
            <p class="sin-resultados-txt">
              No encontramos ofertas que coincidan con tu búsqueda... <br>
              Probá quitando filtros o ampliando tu búsqueda
            </p>
          </div>
        } @else {
          @for (oferta of paged; track oferta.id) {
            <article
              class="oferta-card"
              [ngClass]="estadoClase(oferta)"
              (click)="irADetalle(oferta.id)"
              style="cursor: pointer"
            >
              <div class="oferta-card__head">
                <h3 class="oferta-card__title">{{ oferta.titulo }}</h3>
                <span class="pill" [ngClass]="estadoClase(oferta)">
                  {{ estadoTexto(oferta) }}
                </span>
              </div>

              <p class="oferta-card__desc">
                {{ oferta.descripcion }}
              </p>

              <div class="oferta-card__footer">
                <div class="footer-left">
                  <p>Última actualización:</p>
                  <p *ngIf="getFechaUltimaActualizacion(oferta) != null">
                    {{ getFechaUltimaActualizacion(oferta) | date:'dd/MM/yyyy HH:mm' }}
                  </p>
                </div>

                <div class="footer-right" *ngIf="obtenerEstadoActual(oferta)?.codigo !== 'FINALIZADA'">
                  <div class="label">
                    Candidatos
                    <span>en curso</span>
                  </div>
                  <span class="badge-candidatos">{{ oferta.cantidadPostulados }}</span>
                </div>
              </div>
            </article>
          }
        }
      </ng-template>

    </div>
    @if (ofertas.length > 0 && !isLoading) {
      <div class="paginator">
        <span class="hint">
          Mostrando
          {{ ((page-1)*pageSize)+1 }}
          –
          {{ Math.min(page*pageSize, total) }}
          de {{ total }}
        </span>

        <div class="controls">
          <button class="pg-btn" [disabled]="page===1" (click)="setPage(1)">«</button>
          <button class="pg-btn" [disabled]="page===1" (click)="prevPage()">‹</button>
          <span class="pg-page">{{ page }} / {{ totalPages }}</span>
          <button class="pg-btn" [disabled]="page===totalPages" (click)="nextPage()">›</button>
          <button class="pg-btn" [disabled]="page===totalPages" (click)="setPage(totalPages)">»</button>
        </div>
      </div>
    }
  </div>
</div>